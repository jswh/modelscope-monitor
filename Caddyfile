{
  admin :2019
  log {
    output file /var/log/caddy/access.log
  }
}

# 监听所有接口的 HTTP 请求
http:// {
  # 根据 ENABLE_AUTH 环境变量决定是否启用认证
  @auth_enabled expression {env.ENABLE_AUTH} == "true"
  
  # 仅在 ENABLE_AUTH=true 时启用基本认证
  basic_auth @auth_enabled {
    # 使用 bcrypt 哈希的密码
    # 用户名和密码哈希值来自环境变量
    {$AUTH_USERNAME} {$AUTH_PASSWORD}
  }

  # API 请求代理到后端
  handle /api/* {
    reverse_proxy localhost:8000
  }

  # 静态文件服务
  handle {
    root * /var/www/html
    file_server
    try_files {path} {path}/ /index.html
  }
}